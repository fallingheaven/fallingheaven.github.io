<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="单例模式 实现方法（C#） 饿汉式 1 2 3 4 5 6 7 8 9 public class Singleton { private static readonly Singleton _instance = new Singleton(); // 私有构造函数，防止外部实例化 private Singleton() {} public static Singleton Instance => _instance; } 懒汉式 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 public class Singleton { private static Singleton _instance; private Singleton() {} public static Singleton Instance { get { if (_instance == null) { _instance = new Singleton(); } return _instance; } } } // 双重锁定 public class Singleton { private static Singleton _instance; private static readonly object _lock = new object(); private Singleton() {} public static Singleton Instance { get { if (_instance == null) { lock (_lock) { if (_instance == null) { _instance = new Singleton(); } } } return _instance; } } } Lazy 1 2 3 4 5 6 7 8 public class Singleton { private static readonly Lazy<Singleton> _instance = new Lazy<Singleton>(() => new Singleton()); private Singleton() {} public static Singleton Instance => _instance.Value; } 静态构造 1 2 3 4 5 6 7 8 9 10 11 12 13 public class Singleton { private static readonly Singleton _instance; static Singleton() { _instance = new Singleton(); } private Singleton() {} public static Singleton Instance => _instance; } CAS原子操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class Singleton { private static volatile Singleton _instance; private Singleton() {} public static Singleton Instance { get { // 第一次检查：如果实例已创建，直接返回 if (_instance != null) return _instance; // 使用 CAS 来原子性地创建单例实例 Interlocked.CompareExchange(ref _instance, new Singleton(), null); return _instance; // 返回实例（可能已经是其他线程创建的） } } } // CompareExchange等效于以下代码，由于这个它是原子操作，就不需要加锁 // if (_instance == null) // lock(_instance) //\t{ //\t_instance = new Singleton(); // } 其他 关于线程安全 \u200b\t饿汉式、双重锁定懒汉式、Lazy、静态构造、CAS都是线程安全的\n"><title>设计模式概览</title>
<link rel=canonical href=https://fallingheaven.github.io/p/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%A7%88/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="设计模式概览"><meta property='og:description' content="单例模式 实现方法（C#） 饿汉式 1 2 3 4 5 6 7 8 9 public class Singleton { private static readonly Singleton _instance = new Singleton(); // 私有构造函数，防止外部实例化 private Singleton() {} public static Singleton Instance => _instance; } 懒汉式 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 public class Singleton { private static Singleton _instance; private Singleton() {} public static Singleton Instance { get { if (_instance == null) { _instance = new Singleton(); } return _instance; } } } // 双重锁定 public class Singleton { private static Singleton _instance; private static readonly object _lock = new object(); private Singleton() {} public static Singleton Instance { get { if (_instance == null) { lock (_lock) { if (_instance == null) { _instance = new Singleton(); } } } return _instance; } } } Lazy 1 2 3 4 5 6 7 8 public class Singleton { private static readonly Lazy<Singleton> _instance = new Lazy<Singleton>(() => new Singleton()); private Singleton() {} public static Singleton Instance => _instance.Value; } 静态构造 1 2 3 4 5 6 7 8 9 10 11 12 13 public class Singleton { private static readonly Singleton _instance; static Singleton() { _instance = new Singleton(); } private Singleton() {} public static Singleton Instance => _instance; } CAS原子操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class Singleton { private static volatile Singleton _instance; private Singleton() {} public static Singleton Instance { get { // 第一次检查：如果实例已创建，直接返回 if (_instance != null) return _instance; // 使用 CAS 来原子性地创建单例实例 Interlocked.CompareExchange(ref _instance, new Singleton(), null); return _instance; // 返回实例（可能已经是其他线程创建的） } } } // CompareExchange等效于以下代码，由于这个它是原子操作，就不需要加锁 // if (_instance == null) // lock(_instance) //\t{ //\t_instance = new Singleton(); // } 其他 关于线程安全 \u200b\t饿汉式、双重锁定懒汉式、Lazy、静态构造、CAS都是线程安全的\n"><meta property='og:url' content='https://fallingheaven.github.io/p/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%A7%88/'><meta property='og:site_name' content='个人博客'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='设计模式'><meta property='article:published_time' content='2025-04-20T00:00:00+00:00'><meta property='article:modified_time' content='2025-04-20T00:00:00+00:00'><meta name=twitter:title content="设计模式概览"><meta name=twitter:description content="单例模式 实现方法（C#） 饿汉式 1 2 3 4 5 6 7 8 9 public class Singleton { private static readonly Singleton _instance = new Singleton(); // 私有构造函数，防止外部实例化 private Singleton() {} public static Singleton Instance => _instance; } 懒汉式 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 public class Singleton { private static Singleton _instance; private Singleton() {} public static Singleton Instance { get { if (_instance == null) { _instance = new Singleton(); } return _instance; } } } // 双重锁定 public class Singleton { private static Singleton _instance; private static readonly object _lock = new object(); private Singleton() {} public static Singleton Instance { get { if (_instance == null) { lock (_lock) { if (_instance == null) { _instance = new Singleton(); } } } return _instance; } } } Lazy 1 2 3 4 5 6 7 8 public class Singleton { private static readonly Lazy<Singleton> _instance = new Lazy<Singleton>(() => new Singleton()); private Singleton() {} public static Singleton Instance => _instance.Value; } 静态构造 1 2 3 4 5 6 7 8 9 10 11 12 13 public class Singleton { private static readonly Singleton _instance; static Singleton() { _instance = new Singleton(); } private Singleton() {} public static Singleton Instance => _instance; } CAS原子操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class Singleton { private static volatile Singleton _instance; private Singleton() {} public static Singleton Instance { get { // 第一次检查：如果实例已创建，直接返回 if (_instance != null) return _instance; // 使用 CAS 来原子性地创建单例实例 Interlocked.CompareExchange(ref _instance, new Singleton(), null); return _instance; // 返回实例（可能已经是其他线程创建的） } } } // CompareExchange等效于以下代码，由于这个它是原子操作，就不需要加锁 // if (_instance == null) // lock(_instance) //\t{ //\t_instance = new Singleton(); // } 其他 关于线程安全 \u200b\t饿汉式、双重锁定懒汉式、Lazy、静态构造、CAS都是线程安全的\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_fb8b45451f34c1b8.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>个人博客</a></h1><h2 class=site-description>随便写写</h2></div></header><ol class=menu-social><li><a href=https://github.com/fallingheaven target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#单例模式>单例模式</a><ol><li><a href=#实现方法c>实现方法（C#）</a><ol><li><a href=#饿汉式>饿汉式</a></li><li><a href=#懒汉式>懒汉式</a></li><li><a href=#lazy>Lazy<t></a></li><li><a href=#静态构造>静态构造</a></li><li><a href=#cas原子操作>CAS原子操作</a></li></ol></li><li><a href=#其他>其他</a><ol><li><a href=#关于线程安全>关于线程安全</a></li></ol></li></ol></li><li><a href=#适配器方法>适配器方法</a><ol><li><a href=#组合实现>组合实现</a></li><li><a href=#继承实现>继承实现</a></li><li><a href=#双向适配器>双向适配器</a></li></ol></li><li><a href=#模板方法模式>模板方法模式</a><ol><li><a href=#钩子方法>钩子方法</a></li><li><a href=#iocinversion-of-control控制反转>IoC（Inversion of Control，控制反转）</a></li><li><a href=#dipdependency-inversion-principle依赖倒置原则>DIP（Dependency Inversion Principle，依赖倒置原则）</a></li><li><a href=#dependency-injection依赖注入>Dependency Injection（依赖注入）</a></li></ol></li><li><a href=#迭代器>迭代器</a></li><li><a href=#工厂模式>工厂模式</a><ol><li><a href=#ocp思想开闭原则>OCP思想（开闭原则）</a></li><li><a href=#实现方法>实现方法</a><ol><li><a href=#简单工厂>简单工厂</a></li><li><a href=#工厂方法>工厂方法</a></li><li><a href=#抽象工厂>抽象工厂</a><ol><li><a href=#单抽象的实现>单抽象的实现</a></li><li><a href=#多抽象的实现>多抽象的实现</a></li><li><a href=#借助建造者模式的实现>借助建造者模式的实现</a></li></ol></li></ol></li></ol></li><li><a href=#原型方法>原型方法</a><ol><li><a href=#实现方法-1>实现方法</a></li><li><a href=#深拷贝>深拷贝</a></li></ol></li><li><a href=#建造者模式>建造者模式</a></li><li><a href=#桥接模式>桥接模式</a><ol><li><a href=#实现方法-2>实现方法</a></li></ol></li><li><a href=#装饰器模式>装饰器模式</a></li><li><a href=#状态模式>状态模式</a></li><li><a href=#观察者模式>观察者模式</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%A7%88/>设计模式概览</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 20, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 20 分钟</time></div></footer></div></header><section class=article-content><h2 id=单例模式>单例模式</h2><h3 id=实现方法c>实现方法（C#）</h3><h4 id=饿汉式>饿汉式</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Singleton</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=k>readonly</span> <span class=n>Singleton</span> <span class=n>_instance</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Singleton</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 私有构造函数，防止外部实例化</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Singleton</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>Instance</span> <span class=p>=&gt;</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=懒汉式>懒汉式</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Singleton</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Singleton</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>Instance</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>_instance</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>_instance</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Singleton</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 双重锁定</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Singleton</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=k>readonly</span> <span class=kt>object</span> <span class=n>_lock</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>object</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Singleton</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>Instance</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>_instance</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>lock</span> <span class=p>(</span><span class=n>_lock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>_instance</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>_instance</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Singleton</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lazy>Lazy<t></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Singleton</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=k>readonly</span> <span class=n>Lazy</span><span class=p>&lt;</span><span class=n>Singleton</span><span class=p>&gt;</span> <span class=n>_instance</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Lazy</span><span class=p>&lt;</span><span class=n>Singleton</span><span class=p>&gt;(()</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>Singleton</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Singleton</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>Instance</span> <span class=p>=&gt;</span> <span class=n>_instance</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=静态构造>静态构造</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Singleton</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=k>readonly</span> <span class=n>Singleton</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Singleton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_instance</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Singleton</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Singleton</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>Instance</span> <span class=p>=&gt;</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=cas原子操作>CAS原子操作</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Singleton</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>volatile</span> <span class=n>Singleton</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Singleton</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Singleton</span> <span class=n>Instance</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 第一次检查：如果实例已创建，直接返回</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>_instance</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>_instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// 使用 CAS 来原子性地创建单例实例</span>
</span></span><span class=line><span class=cl>            <span class=n>Interlocked</span><span class=p>.</span><span class=n>CompareExchange</span><span class=p>(</span><span class=k>ref</span> <span class=n>_instance</span><span class=p>,</span> <span class=k>new</span> <span class=n>Singleton</span><span class=p>(),</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>_instance</span><span class=p>;</span>  <span class=c1>// 返回实例（可能已经是其他线程创建的）</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// CompareExchange等效于以下代码，由于这个它是原子操作，就不需要加锁</span>
</span></span><span class=line><span class=cl><span class=c1>// if (_instance == null) </span>
</span></span><span class=line><span class=cl><span class=c1>// 		lock(_instance)</span>
</span></span><span class=line><span class=cl><span class=c1>//		{</span>
</span></span><span class=line><span class=cl><span class=c1>//			_instance = new Singleton();</span>
</span></span><span class=line><span class=cl><span class=c1>// 		}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=其他>其他</h3><h4 id=关于线程安全>关于线程安全</h4><p>​ 饿汉式、双重锁定懒汉式、Lazy、静态构造、CAS都是线程安全的</p><h2 id=适配器方法>适配器方法</h2><p>​ 其思想是通过<strong>统一的接口</strong>写适配器，来适配不同的系统
​ 如触屏输入的XY与鼠标输入的XY，两者方法不同的情况下，可以通过实现相同的接口获取到不同系统的方法
​ 又或者，有一个zip的压缩器和一个rar的压缩器，想用一个统一的压缩、解压方法来使用，可以写两个适配器，都有压缩、解压方法</p><p>​ 组合实现类似包装，继承实现类似扩展，
​ 并且，适配器在对具体类进行适配时，可以不用继承接口（如下面的Zip和Rar）</p><h3 id=组合实现>组合实现</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// Adaptee：需要适配的类</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Zip</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ZipComp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Zip Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ZipDecomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Zip Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Rar</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RarComp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Rar Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RarDecomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Rar Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ICompressor：目标接口</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICompressor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Compress</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Decompress</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 适配器类，包含关系进行引用</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>ZipAdapter</span> <span class=p>:</span> <span class=n>ICompressor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>Zip</span> <span class=n>_zip</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ZipAdapter</span><span class=p>(</span><span class=n>Zip</span> <span class=n>zip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_zip</span> <span class=p>=</span> <span class=n>zip</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Comp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Zip Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Decomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Zip Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>RarAdapter</span> <span class=p>:</span> <span class=n>ICompressor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>Rar</span> <span class=n>_rar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ZipAdapter</span><span class=p>(</span><span class=n>Rar</span> <span class=n>rar</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_rar</span> <span class=p>=</span> <span class=n>rar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Comp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Rar Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Decomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Rar Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Client：客户端</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Client</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Run</span><span class=p>(</span><span class=kt>bool</span> <span class=n>useZip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>zip</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Zip</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>rar</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Rar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>zipAdapter</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ZipAdapter</span><span class=p>(</span><span class=n>zip</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>rarAdapter</span> <span class=p>=</span> <span class=k>new</span> <span class=n>RarAdapter</span><span class=p>(</span><span class=n>rar</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>ICompressor</span> <span class=n>compressor</span> <span class=p>=</span> <span class=n>useZip</span><span class=p>?</span> <span class=n>zipAdapter</span> <span class=p>:</span> <span class=n>rarAdapter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>compressor</span><span class=p>.</span><span class=n>Comp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>compressor</span><span class=p>.</span><span class=n>Decomp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=继承实现>继承实现</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// Adaptee：需要适配的类</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Zip</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ZipComp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Zip Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ZipDecomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Zip Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Rar</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RarComp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Rar Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RarDecomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Debug</span><span class=p>.</span><span class=n>Log</span><span class=p>(</span><span class=s>&#34;Rar Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ICompressor：目标接口</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICompressor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Compress</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Decompress</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 适配器类，继承实现，类似于在原类中额外加了两个通用方法</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>ZipAdapter</span> <span class=p>:</span> <span class=n>Zip</span><span class=p>,</span> <span class=n>ICompressor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Comp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ZipComp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Decomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ZipDecomp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>RarAdapter</span> <span class=p>:</span> <span class=n>Rar</span><span class=p>,</span> <span class=n>ICompressor</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Comp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RarComp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Decomp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RarDecomp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Client：客户端</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Client</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Run</span><span class=p>(</span><span class=kt>bool</span> <span class=n>useZip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kt>var</span> <span class=n>zipAdapter</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ZipAdapter</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>rarAdapter</span> <span class=p>=</span> <span class=k>new</span> <span class=n>RarAdapter</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>ICompressor</span> <span class=n>compressor</span> <span class=p>=</span> <span class=n>useZip</span><span class=p>?</span> <span class=n>zipAdapter</span> <span class=p>:</span> <span class=n>rarAdapter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>compressor</span><span class=p>.</span><span class=n>Comp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>compressor</span><span class=p>.</span><span class=n>Decomp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=双向适配器>双向适配器</h3><p>​ 这个简单来说，就是需要zip和rar相互支持，我本以为上述代码某种程度上实现了这一功能，但实际上，上述代码是将两种接口通过单向适配器适配到了通用接口上。
​ 双向适配器则是用来zip向rar接口转换，以及rar接口向zip接口转换，调用zip方法实际上调用的rar方法，
​ 对于不能多重继承的语言，双向适配器由组合实现。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// Zip 类</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Zip</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ZipCompress</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Zip: Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>ZipDecompress</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Zip: Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Rar 类</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Rar</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RarCompress</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Rar: Compress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>RarDecompress</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Rar: Decompress&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 双向适配器</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>BidirectionalAdapter</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Zip</span> <span class=n>_zip</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Rar</span> <span class=n>_rar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 构造方法，用于适配 Zip</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>BidirectionalAdapter</span><span class=p>(</span><span class=n>Zip</span> <span class=n>zip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_zip</span> <span class=p>=</span> <span class=n>zip</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 构造方法，用于适配 Rar</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>BidirectionalAdapter</span><span class=p>(</span><span class=n>Rar</span> <span class=n>rar</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_rar</span> <span class=p>=</span> <span class=n>rar</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 调用压缩方法</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Compress</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>_zip</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_zip</span><span class=p>.</span><span class=n>ZipCompress</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>_rar</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Adapting Rar to Zip&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>_rar</span><span class=p>.</span><span class=n>RarCompress</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 调用解压方法</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Decompress</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>_zip</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_zip</span><span class=p>.</span><span class=n>ZipDecompress</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>_rar</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;Adapting Zip to Rar&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>_rar</span><span class=p>.</span><span class=n>RarDecompress</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=模板方法模式>模板方法模式</h2><p>​ 其实就是抽象类的实现，因此不多赘述</p><h3 id=钩子方法>钩子方法</h3><p>​ 其思想在于在子类中实现的逻辑会影响父类中的逻辑
​ 如一个条件判断的方法，我们在子类中重写后，就会影响父类相应的条件判断</p><h3 id=iocinversion-of-control控制反转>IoC（Inversion of Control，控制反转）</h3><p>​ IoC 是一种设计原则，指将<strong>对象的创建或依赖关系的管理交给外部容器</strong>，而不是由对象自身控制。通过 IoC，可以降低模块之间的耦合性，提高代码的灵活性和可维护性。</p><h3 id=dipdependency-inversion-principle依赖倒置原则>DIP（Dependency Inversion Principle，依赖倒置原则）</h3><p>​ 高层模块不应该依赖于低层模块，二者都应该依赖于抽象。
​ 抽象不应该依赖于具体实现，具体实现应该依赖于抽象。
​ 也就是现有抽象，再实现抽象</p><h3 id=dependency-injection依赖注入>Dependency Injection（依赖注入）</h3><p>​ 依赖注入是<strong>实现 IoC 的一种方式</strong>，通过将依赖对象注入到目标对象中，而不是目标对象自己创建依赖对象</p><ul><li><p>常见的依赖注入方式有：</p><ul><li><p>构造器注入：通过构造方法传递依赖。</p></li><li><p>Setter 方法注入：通过 Setter 方法传递依赖。</p></li><li><p>接口注入：通过接口方法（即接口实现Setter方法）传递依赖。</p></li></ul></li></ul><h2 id=迭代器>迭代器</h2><p>​ 与其说一种模式，不如说是对于OOAD和模板方法的典型实践
​ 其思想是提供一种方法顺序（不确定 ）访问一个聚合对象中各个元素，而又不暴露该对象的内部表示</p><h2 id=工厂模式>工厂模式</h2><h3 id=ocp思想开闭原则>OCP思想（开闭原则）</h3><p>​ 开闭原则 (OCP) 是面向对象编程中的一个基本原则，它指出应用程序实体（类、模块、方法等）应该对扩展开放但对修改关闭。换句话说，您应该能够在不更改现有代码的情况下向应用程序添加新功能。</p><p>​ 对于本模式，也就是可以在不修改现有工厂、产品类的同时，加入新的工厂、产品等</p><h3 id=实现方法>实现方法</h3><h4 id=简单工厂>简单工厂</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// 需求是一个工厂需要生产不同的产品</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Factory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IProduct</span> <span class=n>Create</span><span class=p>(</span><span class=kt>string</span> <span class=n>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;A&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        	<span class=k>return</span> <span class=k>new</span> <span class=n>ProductA</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        	<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;B&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        	<span class=k>return</span> <span class=k>new</span> <span class=n>ProductB</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        	<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        	<span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        	<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IProduct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>ProductA</span> <span class=p>:</span> <span class=n>IProduct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>ProductB</span> <span class=p>:</span> <span class=n>IProduct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=工厂方法>工厂方法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// 需求是多个工厂，一个工厂生产一种商品</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IProduct</span> <span class=n>Create</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Factory</span> <span class=p>:</span> <span class=n>IFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IProduct</span> <span class=n>Create</span><span class=p>(</span><span class=kt>string</span> <span class=n>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;A&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        	<span class=k>return</span> <span class=k>new</span> <span class=n>ProductA</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        	<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;B&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        	<span class=k>return</span> <span class=k>new</span> <span class=n>ProductB</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        	<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        	<span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        	<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IProduct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>ProductA</span> <span class=p>:</span> <span class=n>IProduct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>ProductB</span> <span class=p>:</span> <span class=n>IProduct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=抽象工厂>抽象工厂</h4><p>​ 是为了解决存在多个不同的产品族，每个具体工厂会生产某产品族</p><p>​ 添加具体工厂类是容易的，但添加具体产品是麻烦的，需要对工厂的方法进行扩展（如添加CreateProductC方法），表现为OCP的倾斜性</p><p><strong>对于抽象工厂和工厂模式的区别：</strong></p><p>​ 工厂方法模式：A -> F1，F1 生产 P1；A -> F2，F2 生产 P2。每个工厂只负责生产一种类型的产品。</p><p>​ 抽象工厂模式：A -> F1.1，F1.1 生产 P1.1；A -> F1.2，F1.2 生产 P1.2。每个工厂负责生产一组相关的产品</p><h5 id=单抽象的实现>单抽象的实现</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// --- 1. Abstract Products ---</span>
</span></span><span class=line><span class=cl><span class=c1>// 定义文档组成部分（产品）的抽象接口</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 基础文本元素接口</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ITextElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>Render</span><span class=p>();</span> <span class=c1>// 每个元素都知道如何将自己渲染成字符串</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 抽象标题元素</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ITitleElement</span> <span class=p>:</span> <span class=n>ITextElement</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 抽象内容元素</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IContentElement</span> <span class=p>:</span> <span class=n>ITextElement</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 2. Concrete Products ---</span>
</span></span><span class=line><span class=cl><span class=c1>// 为每种格式（Markdown, HTML）实现具体的文档组成部分</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Markdown 产品 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownTitleElement</span> <span class=p>:</span> <span class=n>ITitleElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MarkdownTitleElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;# {_text}\n&#34;</span><span class=p>;</span> <span class=c1>// 返回 Markdown 标题格式</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownContentElement</span> <span class=p>:</span> <span class=n>IContentElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MarkdownContentElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;{_text}\n&#34;</span><span class=p>;</span> <span class=c1>// 返回 Markdown 内容格式</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- HTML 产品 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlTitleElement</span> <span class=p>:</span> <span class=n>ITitleElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HtmlTitleElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;&lt;h1&gt;{_text}&lt;/h1&gt;\n&#34;</span><span class=p>;</span> <span class=c1>// 返回 HTML H1 格式</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlContentElement</span> <span class=p>:</span> <span class=n>IContentElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HtmlContentElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;&lt;p&gt;{_text}&lt;/p&gt;\n&#34;</span><span class=p>;</span> <span class=c1>// 返回 HTML 段落格式</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 3. Abstract Factory ---</span>
</span></span><span class=line><span class=cl><span class=c1>// 定义创建一系列相关产品（文本元素）的接口</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ITextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ITitleElement</span> <span class=n>CreateTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>IContentElement</span> <span class=n>CreateContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 可以添加更多方法来创建其他元素，如 CreateList, CreateLink 等</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 4. Concrete Factories ---</span>
</span></span><span class=line><span class=cl><span class=c1>// 实现抽象工厂接口，为特定格式创建具体的产品实例</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Markdown 工厂 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownDocumentFactory</span> <span class=p>:</span> <span class=n>ITextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ITitleElement</span> <span class=n>CreateTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>MarkdownTitleElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span> <span class=c1>// 直接返回具体产品</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IContentElement</span> <span class=n>CreateContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>MarkdownContentElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span> <span class=c1>// 直接返回具体产品</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- HTML 工厂 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlDocumentFactory</span> <span class=p>:</span> <span class=n>ITextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ITitleElement</span> <span class=n>CreateTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HtmlTitleElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span> <span class=c1>// 直接返回具体产品</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IContentElement</span> <span class=n>CreateContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HtmlContentElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span> <span class=c1>// 直接返回具体产品</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 5. Client Code ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>DocumentAssembler</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 客户端使用工厂创建的元素列表来组装文档</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>ITextElement</span><span class=p>&gt;</span> <span class=n>_elements</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>ITextElement</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 客户端调用工厂来创建零件，然后自己存储这些零件</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>AddElement</span><span class=p>(</span><span class=n>ITextElement</span> <span class=n>element</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_elements</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>element</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 客户端负责将所有零件组合（渲染）成最终文档</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>AssembleDocument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StringBuilder</span> <span class=n>finalDocument</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// --- HTML 特殊处理：添加外层标签 ---</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 注意：这种格式特定的组装逻辑现在在客户端，</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 或者可以引入更复杂的结构来处理。</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 对于纯粹的抽象工厂，客户端通常需要知道如何组合。</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 如果第一个元素是 HtmlTitleElement，我们可能想添加&lt;html&gt;&lt;body&gt;等</span>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=n>isHtml</span> <span class=p>=</span> <span class=n>_elements</span><span class=p>.</span><span class=n>Count</span> <span class=p>&gt;</span> <span class=m>0</span> <span class=p>&amp;&amp;</span> <span class=n>_elements</span><span class=p>[</span><span class=m>0</span><span class=p>]</span> <span class=k>is</span> <span class=n>HtmlTitleElement</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>isHtml</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=n>finalDocument</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;!DOCTYPE html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>             <span class=n>finalDocument</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>             <span class=n>finalDocument</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;head&gt;&lt;title&gt;Generated Document&lt;/title&gt;&lt;/head&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>             <span class=n>finalDocument</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;body&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>element</span> <span class=k>in</span> <span class=n>_elements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>finalDocument</span><span class=p>.</span><span class=n>Append</span><span class=p>(</span><span class=n>element</span><span class=p>.</span><span class=n>Render</span><span class=p>());</span> <span class=c1>// 调用每个元素的渲染方法</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>         <span class=k>if</span> <span class=p>(</span><span class=n>isHtml</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=n>finalDocument</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;/body&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>             <span class=n>finalDocument</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;/html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>finalDocument</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_elements</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 示例用法 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// --- 选择 Markdown 工厂 ---</span>
</span></span><span class=line><span class=cl>        <span class=n>ITextDocumentFactory</span> <span class=n>factory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MarkdownDocumentFactory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>DocumentAssembler</span> <span class=n>assembler</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DocumentAssembler</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 客户端使用工厂创建零件，并添加到组装器</span>
</span></span><span class=line><span class=cl>        <span class=n>ITitleElement</span> <span class=n>mdTitle</span> <span class=p>=</span> <span class=n>factory</span><span class=p>.</span><span class=n>CreateTitle</span><span class=p>(</span><span class=s>&#34;My Markdown Document&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assembler</span><span class=p>.</span><span class=n>AddElement</span><span class=p>(</span><span class=n>mdTitle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>IContentElement</span> <span class=n>mdContent</span> <span class=p>=</span> <span class=n>factory</span><span class=p>.</span><span class=n>CreateContent</span><span class=p>(</span><span class=s>&#34;This is Markdown content.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assembler</span><span class=p>.</span><span class=n>AddElement</span><span class=p>(</span><span class=n>mdContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 客户端组装并获取最终文档</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>markdownDoc</span> <span class=p>=</span> <span class=n>assembler</span><span class=p>.</span><span class=n>AssembleDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>markdownDoc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// --- 清理并切换到 HTML 工厂 ---</span>
</span></span><span class=line><span class=cl>        <span class=n>assembler</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>factory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HtmlDocumentFactory</span><span class=p>();</span> <span class=c1>// 更换工厂实例</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 使用新工厂创建零件</span>
</span></span><span class=line><span class=cl>        <span class=n>ITitleElement</span> <span class=n>htmlTitle</span> <span class=p>=</span> <span class=n>factory</span><span class=p>.</span><span class=n>CreateTitle</span><span class=p>(</span><span class=s>&#34;My HTML Document&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assembler</span><span class=p>.</span><span class=n>AddElement</span><span class=p>(</span><span class=n>htmlTitle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>IContentElement</span> <span class=n>htmlContent</span> <span class=p>=</span> <span class=n>factory</span><span class=p>.</span><span class=n>CreateContent</span><span class=p>(</span><span class=s>&#34;This is &lt;b&gt;HTML&lt;/b&gt; content.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assembler</span><span class=p>.</span><span class=n>AddElement</span><span class=p>(</span><span class=n>htmlContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>         <span class=c1>// 客户端使用相同的组装逻辑（但零件不同）</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>htmlDoc</span> <span class=p>=</span> <span class=n>assembler</span><span class=p>.</span><span class=n>AssembleDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>htmlDoc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>classDiagram
</span></span><span class=line><span class=cl>    direction LR
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    %% --- Interfaces / Abstract Classes ---
</span></span><span class=line><span class=cl>    class ITextElement {
</span></span><span class=line><span class=cl>      &lt;&lt;Interface&gt;&gt;
</span></span><span class=line><span class=cl>      +Render() string
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class ITitleElement {
</span></span><span class=line><span class=cl>      &lt;&lt;Interface&gt;&gt;
</span></span><span class=line><span class=cl>      # Inherits ITextElement
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class IContentElement {
</span></span><span class=line><span class=cl>      &lt;&lt;Interface&gt;&gt;
</span></span><span class=line><span class=cl>      # Inherits ITextElement
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ITextElement &lt;|.. ITitleElement
</span></span><span class=line><span class=cl>    ITextElement &lt;|.. IContentElement
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    class ITextDocumentFactory {
</span></span><span class=line><span class=cl>      &lt;&lt;Interface&gt;&gt;
</span></span><span class=line><span class=cl>      +CreateTitle(text: string) ITitleElement
</span></span><span class=line><span class=cl>      +CreateContent(text: string) IContentElement
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    %% --- Concrete Products ---
</span></span><span class=line><span class=cl>    class MarkdownTitleElement {
</span></span><span class=line><span class=cl>      -text: string
</span></span><span class=line><span class=cl>      +Render() string
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class MarkdownContentElement {
</span></span><span class=line><span class=cl>      -text: string
</span></span><span class=line><span class=cl>      +Render() string
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class HtmlTitleElement {
</span></span><span class=line><span class=cl>      -text: string
</span></span><span class=line><span class=cl>      +Render() string
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class HtmlContentElement {
</span></span><span class=line><span class=cl>      -text: string
</span></span><span class=line><span class=cl>      +Render() string
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    %% --- Concrete Factories ---
</span></span><span class=line><span class=cl>    class MarkdownDocumentFactory {
</span></span><span class=line><span class=cl>      +CreateTitle(text: string) ITitleElement
</span></span><span class=line><span class=cl>      +CreateContent(text: string) IContentElement
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class HtmlDocumentFactory {
</span></span><span class=line><span class=cl>      +CreateTitle(text: string) ITitleElement
</span></span><span class=line><span class=cl>      +CreateContent(text: string) IContentElement
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    %% --- Client ---
</span></span><span class=line><span class=cl>    class DocumentAssembler {
</span></span><span class=line><span class=cl>      -elements: List~ITextElement~
</span></span><span class=line><span class=cl>      +AddElement(element: ITextElement) void
</span></span><span class=line><span class=cl>      +AssembleDocument() string
</span></span><span class=line><span class=cl>      +Clear() void
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class Program {
</span></span><span class=line><span class=cl>      +Main(args: string[]) void
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    %% --- Relationships ---
</span></span><span class=line><span class=cl>    ITitleElement &lt;|.. MarkdownTitleElement
</span></span><span class=line><span class=cl>    IContentElement &lt;|.. MarkdownContentElement
</span></span><span class=line><span class=cl>    ITitleElement &lt;|.. HtmlTitleElement
</span></span><span class=line><span class=cl>    IContentElement &lt;|.. HtmlContentElement
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ITextDocumentFactory &lt;|.. MarkdownDocumentFactory
</span></span><span class=line><span class=cl>    ITextDocumentFactory &lt;|.. HtmlDocumentFactory
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    MarkdownDocumentFactory ..&gt; MarkdownTitleElement : creates
</span></span><span class=line><span class=cl>    MarkdownDocumentFactory ..&gt; MarkdownContentElement : creates
</span></span><span class=line><span class=cl>    HtmlDocumentFactory ..&gt; HtmlTitleElement : creates
</span></span><span class=line><span class=cl>    HtmlDocumentFactory ..&gt; HtmlContentElement : creates
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    DocumentAssembler ..&gt; ITextDocumentFactory : uses
</span></span><span class=line><span class=cl>    DocumentAssembler &#34;1&#34; o-- &#34;*&#34; ITextElement : aggregates
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Program ..&gt; DocumentAssembler : uses
</span></span><span class=line><span class=cl>    Program ..&gt; ITextDocumentFactory : uses
</span></span></code></pre></td></tr></table></div></div><h5 id=多抽象的实现>多抽象的实现</h5><p>​ 这个工厂的使用其实是有些别扭的，例如我们需要对html进行额外的判断，也许我们可以把这个判断也作为产品的一部分？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 1. Abstract Products ---</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 保持不变: 代表可渲染的独立元素</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ITextElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>Render</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ITitleElement</span> <span class=p>:</span> <span class=n>ITextElement</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IContentElement</span> <span class=p>:</span> <span class=n>ITextElement</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 新增: 代表整个文档的结构/容器</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IDocument</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>void</span> <span class=n>AddElement</span><span class=p>(</span><span class=n>ITextElement</span> <span class=n>element</span><span class=p>);</span> <span class=c1>// 向文档结构中添加元素</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>RenderDocument</span><span class=p>();</span>               <span class=c1>// 渲染整个文档，包含必要的结构标签</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 2. Concrete Products ---</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Markdown 产品 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownTitleElement</span> <span class=p>:</span> <span class=n>ITitleElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MarkdownTitleElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;# {_text}\n&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownContentElement</span> <span class=p>:</span> <span class=n>IContentElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MarkdownContentElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;{_text}\n&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 新增: Markdown 文档结构产品</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownDocument</span> <span class=p>:</span> <span class=n>IDocument</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>ITextElement</span><span class=p>&gt;</span> <span class=n>_elements</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>ITextElement</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>AddElement</span><span class=p>(</span><span class=n>ITextElement</span> <span class=n>element</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_elements</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>element</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Markdown 通常不需要特殊的全局包装器</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>RenderDocument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StringBuilder</span> <span class=n>sb</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>element</span> <span class=k>in</span> <span class=n>_elements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>sb</span><span class=p>.</span><span class=n>Append</span><span class=p>(</span><span class=n>element</span><span class=p>.</span><span class=n>Render</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>sb</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- HTML 产品 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlTitleElement</span> <span class=p>:</span> <span class=n>ITitleElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HtmlTitleElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;    &lt;h1&gt;{_text}&lt;/h1&gt;\n&#34;</span><span class=p>;</span> <span class=c1>// Indentation for readability</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlContentElement</span> <span class=p>:</span> <span class=n>IContentElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=kt>string</span> <span class=n>_text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HtmlContentElement</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span> <span class=n>_text</span> <span class=p>=</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Render</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=s>$&#34;    &lt;p&gt;{_text}&lt;/p&gt;\n&#34;</span><span class=p>;</span> <span class=c1>// Indentation for readability</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 新增: HTML 文档结构产品</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlDocument</span> <span class=p>:</span> <span class=n>IDocument</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>ITextElement</span><span class=p>&gt;</span> <span class=n>_elements</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>ITextElement</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>string</span> <span class=n>_pageTitle</span> <span class=p>=</span> <span class=s>&#34;Generated Document&#34;</span><span class=p>;</span> <span class=c1>// Default title</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>AddElement</span><span class=p>(</span><span class=n>ITextElement</span> <span class=n>element</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_elements</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>element</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// HTML 文档的渲染包含了必要的包装标签</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>RenderDocument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StringBuilder</span> <span class=n>sb</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;!DOCTYPE html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;head&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>$&#34;&lt;title&gt;{_pageTitle}&lt;/title&gt;&#34;</span><span class=p>);</span> <span class=c1>// Use the stored title</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;/head&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;body&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>element</span> <span class=k>in</span> <span class=n>_elements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>sb</span><span class=p>.</span><span class=n>Append</span><span class=p>(</span><span class=n>element</span><span class=p>.</span><span class=n>Render</span><span class=p>());</span> <span class=c1>// Append rendered element</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;/body&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sb</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;/html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>sb</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 3. Abstract Factory ---</span>
</span></span><span class=line><span class=cl><span class=c1>// 添加创建 IDocument 的方法</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ITextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>IDocument</span> <span class=n>CreateDocument</span><span class=p>();</span> <span class=c1>// 创建文档结构对象</span>
</span></span><span class=line><span class=cl>    <span class=n>ITitleElement</span> <span class=n>CreateTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>IContentElement</span> <span class=n>CreateContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 4. Concrete Factories ---</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Markdown 工厂 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownDocumentFactory</span> <span class=p>:</span> <span class=n>ITextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IDocument</span> <span class=n>CreateDocument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>MarkdownDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ITitleElement</span> <span class=n>CreateTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>MarkdownTitleElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IContentElement</span> <span class=n>CreateContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>MarkdownContentElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- HTML 工厂 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlDocumentFactory</span> <span class=p>:</span> <span class=n>ITextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=kd>public</span> <span class=n>IDocument</span> <span class=n>CreateDocument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HtmlDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ITitleElement</span> <span class=n>CreateTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HtmlTitleElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IContentElement</span> <span class=n>CreateContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HtmlContentElement</span><span class=p>(</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 5. Client Code ---</span>
</span></span><span class=line><span class=cl><span class=c1>// 客户端现在变得更通用，不再关心具体格式的包装细节</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>DocumentGeneratorClient</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ITextDocumentFactory</span> <span class=n>_factory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DocumentGeneratorClient</span><span class=p>(</span><span class=n>ITextDocumentFactory</span> <span class=n>factory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_factory</span> <span class=p>=</span> <span class=n>factory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Generate</span><span class=p>(</span><span class=kt>string</span> <span class=n>title</span><span class=p>,</span> <span class=kt>string</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 1. 创建文档结构对象 (由工厂决定是 MarkdownDocument 还是 HtmlDocument)</span>
</span></span><span class=line><span class=cl>        <span class=n>IDocument</span> <span class=n>document</span> <span class=p>=</span> <span class=n>_factory</span><span class=p>.</span><span class=n>CreateDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 2. 创建具体的元素 (由工厂决定是 Markdown 还是 HTML 元素)</span>
</span></span><span class=line><span class=cl>        <span class=n>ITitleElement</span> <span class=n>titleElement</span> <span class=p>=</span> <span class=n>_factory</span><span class=p>.</span><span class=n>CreateTitle</span><span class=p>(</span><span class=n>title</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>IContentElement</span> <span class=n>contentElement</span> <span class=p>=</span> <span class=n>_factory</span><span class=p>.</span><span class=n>CreateContent</span><span class=p>(</span><span class=n>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 3. 将元素添加到文档结构中</span>
</span></span><span class=line><span class=cl>        <span class=n>document</span><span class=p>.</span><span class=n>AddElement</span><span class=p>(</span><span class=n>titleElement</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>document</span><span class=p>.</span><span class=n>AddElement</span><span class=p>(</span><span class=n>contentElement</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 4. 请求文档结构对象进行最终渲染</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>document</span><span class=p>.</span><span class=n>RenderDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=kd>public</span> <span class=k>void</span> <span class=n>SetFactory</span><span class=p>(</span><span class=n>ITextDocumentFactory</span> <span class=n>factory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_factory</span> <span class=p>=</span> <span class=n>factory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 示例用法 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// --- 使用 Markdown 工厂 ---</span>
</span></span><span class=line><span class=cl>        <span class=n>ITextDocumentFactory</span> <span class=n>factory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MarkdownDocumentFactory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>DocumentGeneratorClient</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DocumentGeneratorClient</span><span class=p>(</span><span class=n>factory</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>markdownDoc</span> <span class=p>=</span> <span class=n>client</span><span class=p>.</span><span class=n>Generate</span><span class=p>(</span><span class=s>&#34;My Markdown Document&#34;</span><span class=p>,</span> <span class=s>&#34;This is Markdown content.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>markdownDoc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// --- 切换到 HTML 工厂 ---</span>
</span></span><span class=line><span class=cl>        <span class=n>client</span><span class=p>.</span><span class=n>SetFactory</span><span class=p>(</span><span class=k>new</span> <span class=n>HtmlDocumentFactory</span><span class=p>());</span> <span class=c1>// 更换工厂实例</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>htmlDoc</span> <span class=p>=</span> <span class=n>client</span><span class=p>.</span><span class=n>Generate</span><span class=p>(</span><span class=s>&#34;My HTML Document&#34;</span><span class=p>,</span> <span class=s>&#34;This is &lt;b&gt;HTML&lt;/b&gt; content.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>htmlDoc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=借助建造者模式的实现>借助建造者模式的实现</h5><p>​ 在学习了建造者模式，回过头来，可以发现其实DocumentGeneratorClient是一个Director，他们的行为也很相似，例如创建文档对象、添加元素、生成文档内容，这个步骤和建造者基本一致</p><p>​ 但不同点在于工厂返回了多个同族的对象，另外，尽管IDocument和ITextElement是相互独立的，但他们也是同族的，这里的概念在于他们都是Markdown/Html格式，而非在于他们都是实现某个接口</p><p>​ 下面我们尝试用接近建造者模式的工厂模式进行尝试：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// 1. Abstract Factory (抽象工厂)</span>
</span></span><span class=line><span class=cl><span class=c1>// 定义了创建文档各个部分（产品）以及获取最终结果的接口</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=k>class</span> <span class=nc>TextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 建造者的构建步骤</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=k>void</span> <span class=n>AddTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>title</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=k>void</span> <span class=n>AddContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取最终产品（整个格式化后的文档）</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>string</span> <span class=n>GetResult</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 重置工厂状态，以便创建新文档</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=k>void</span> <span class=n>Reset</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 2. Concrete Factories (具体工厂)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Markdown 工厂 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MarkdownFactory</span> <span class=p>:</span> <span class=n>TextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>StringBuilder</span> <span class=n>_document</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=k>void</span> <span class=n>Reset</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=k>void</span> <span class=n>AddTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>$&#34;# {title}&#34;</span><span class=p>);</span> <span class=c1>// Markdown H1 标题</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>();</span> <span class=c1>// 添加空行</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=k>void</span> <span class=n>AddContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=n>content</span><span class=p>);</span> <span class=c1>// Markdown 段落</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>();</span> <span class=c1>// 添加空行</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回构建好的 Markdown 字符串</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=kt>string</span> <span class=n>GetResult</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>result</span> <span class=p>=</span> <span class=n>_document</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Reset(); // 可以在获取结果后自动重置</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- HTML 工厂 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HtmlFactory</span> <span class=p>:</span> <span class=n>TextDocumentFactory</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>StringBuilder</span> <span class=n>_document</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>bool</span> <span class=n>_bodyOpened</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span> <span class=c1>// 简单状态跟踪</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=kd>public</span> <span class=kd>override</span> <span class=k>void</span> <span class=n>Reset</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_bodyOpened</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;!DOCTYPE html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;head&gt;&lt;title&gt;Generated Document&lt;/title&gt;&lt;/head&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>EnsureBodyOpened</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(!</span><span class=n>_bodyOpened</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;body&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>_bodyOpened</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=k>void</span> <span class=n>AddTitle</span><span class=p>(</span><span class=kt>string</span> <span class=n>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>EnsureBodyOpened</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>$&#34;    &lt;h1&gt;{title}&lt;/h1&gt;&#34;</span><span class=p>);</span> <span class=c1>// HTML H1 标题</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=k>void</span> <span class=n>AddContent</span><span class=p>(</span><span class=kt>string</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=n>EnsureBodyOpened</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>$&#34;    &lt;p&gt;{content}&lt;/p&gt;&#34;</span><span class=p>);</span> <span class=c1>// HTML 段落</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回构建好的 HTML 字符串</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>override</span> <span class=kt>string</span> <span class=n>GetResult</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>_bodyOpened</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;/body&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>_document</span><span class=p>.</span><span class=n>AppendLine</span><span class=p>(</span><span class=s>&#34;&lt;/html&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>result</span> <span class=p>=</span> <span class=n>_document</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>       <span class=c1>// Reset(); // 可以在获取结果后自动重置</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 3. Client Code (客户端代码)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>DocumentGenerator</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 客户端依赖于抽象工厂接口</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>TextDocumentFactory</span> <span class=n>_factory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DocumentGenerator</span><span class=p>(</span><span class=n>TextDocumentFactory</span> <span class=n>factory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>_factory</span> <span class=p>=</span> <span class=n>factory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>_factory</span><span class=p>.</span><span class=n>Reset</span><span class=p>();</span> <span class=c1>// 初始化时重置工厂</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 客户端使用工厂来构建文档，不关心具体格式</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>GenerateDocument</span><span class=p>(</span><span class=kt>string</span> <span class=n>title</span><span class=p>,</span> <span class=kt>string</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 注意：这里客户端调用的顺序决定了文档结构</span>
</span></span><span class=line><span class=cl>        <span class=n>_factory</span><span class=p>.</span><span class=n>AddTitle</span><span class=p>(</span><span class=n>title</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>_factory</span><span class=p>.</span><span class=n>AddContent</span><span class=p>(</span><span class=n>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 可以添加更多步骤，如 AddSection, AddImage 等，只要在 Factory 接口和实现中定义</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>_factory</span><span class=p>.</span><span class=n>GetResult</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=c1>// 允许更换工厂</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>SetFactory</span><span class=p>(</span><span class=n>TextDocumentFactory</span> <span class=n>factory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>_factory</span> <span class=p>=</span> <span class=n>factory</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>_factory</span><span class=p>.</span><span class=n>Reset</span><span class=p>();</span> <span class=c1>// 更换后重置</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- 示例用法 ---</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// --- 使用 Markdown 工厂 ---</span>
</span></span><span class=line><span class=cl>        <span class=n>TextDocumentFactory</span> <span class=n>markdownFactory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MarkdownFactory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>DocumentGenerator</span> <span class=n>generator</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DocumentGenerator</span><span class=p>(</span><span class=n>markdownFactory</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>markdownDoc</span> <span class=p>=</span> <span class=n>generator</span><span class=p>.</span><span class=n>GenerateDocument</span><span class=p>(</span><span class=s>&#34;My Markdown Document&#34;</span><span class=p>,</span> <span class=s>&#34;This is the content in Markdown format.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>markdownDoc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// --- 切换到 HTML 工厂 ---</span>
</span></span><span class=line><span class=cl>        <span class=n>TextDocumentFactory</span> <span class=n>htmlFactory</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HtmlFactory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>generator</span><span class=p>.</span><span class=n>SetFactory</span><span class=p>(</span><span class=n>htmlFactory</span><span class=p>);</span> <span class=c1>// 更换生成器的工厂</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>htmlDoc</span> <span class=p>=</span> <span class=n>generator</span><span class=p>.</span><span class=n>GenerateDocument</span><span class=p>(</span><span class=s>&#34;My HTML Document&#34;</span><span class=p>,</span> <span class=s>&#34;This is the content in &lt;b&gt;HTML&lt;/b&gt; format.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>htmlDoc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 我个人是更倾向于这种实现的，十分的简洁，但可能不太适应更复杂的场景，只用于生成某个格式的文档内容</p><p>​ 以建造者模式的角度来看，其中DocumentGenerator算是Director，Factory的具体类是Builder，产品是string</p><h2 id=原型方法>原型方法</h2><p>​ 不是通过类（构造函数）获得实例，而是通过类的实例复制得到实例</p><h3 id=实现方法-1>实现方法</h3><p>​ 一般来讲，就是实现一个接口实现克隆，如JAVA中的Cloneable接口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Info</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Cloneable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>text</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Info</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>text</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>text</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>clone</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CloneNotSupportedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>clone</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=深拷贝>深拷贝</h3><p>​ 有时候需要拷贝引用对象的值，而非引用同一对象，这时需要对其中的引用进行拷贝</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>File</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Cloneable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>text</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Info</span><span class=w> </span><span class=n>info</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>File</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>text</span><span class=p>,</span><span class=w> </span><span class=n>Info</span><span class=w> </span><span class=n>info</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>text</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>text</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>info</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>clone</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CloneNotSupportedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>File</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>clone</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>file</span><span class=p>.</span><span class=na>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>file</span><span class=p>.</span><span class=na>info</span><span class=p>.</span><span class=na>clone</span><span class=p>();</span><span class=w> </span><span class=c1>// 拷贝引用对象的值，生成新实例</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=k>return</span><span class=w> </span><span class=n>file</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=建造者模式>建造者模式</h2><p>​ 用于构建较为复杂但可以通过组合来生成的对象</p><p>​ 以构建角色为例，下面的例子借助了Director和流式接口。
​ 指挥者类CharacterDirector隔离了用户和实际的生产过程，当然也可以外部直接去生成Character Builder实例，通过这个建造者实例去生成Character实例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Character</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>weapon</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span><span class=p>(</span><span class=n>Character</span> <span class=n>character</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=p>=</span> <span class=n>character</span><span class=p>.</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>weapon</span> <span class=p>=</span> <span class=n>character</span><span class=p>.</span><span class=n>weapon</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICharacterBuilder</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>Create</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>SetName</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>SetWeapon</span><span class=p>(</span><span class=kt>string</span> <span class=n>weapon</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CharacterBuilder</span> <span class=p>:</span> <span class=n>ICharacterBuilder</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Character</span> <span class=n>_character</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>Create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>Character</span><span class=p>(</span><span class=n>_character</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>SetName</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>name</span> <span class=p>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>SetWeapon</span><span class=p>(</span><span class=kt>string</span> <span class=n>weapon</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>weapon</span> <span class=p>=</span> <span class=n>weapon</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CharacterDirector</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>CharacterBuilder</span> <span class=n>_builder</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CharacterDirector</span><span class=p>(</span><span class=n>CharacterBuilder</span> <span class=n>builder</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_builder</span> <span class=p>=</span> <span class=n>builder</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>CreateWarrior</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Character</span> <span class=n>result</span> <span class=p>=</span> <span class=n>_builder</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetName</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetWeapon</span><span class=p>(</span><span class=s>&#34;Sword&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>CreateMgician</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Character</span> <span class=n>result</span> <span class=p>=</span> <span class=n>_builder</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetName</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetWeapon</span><span class=p>(</span><span class=s>&#34;Wand&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 下面给出另一种创建的实现，但需要仔细思考这是否符合建造者模式？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Character</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>weapon</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>SetName</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>name</span> <span class=p>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>SetWeapon</span><span class=p>(</span><span class=kt>string</span> <span class=n>weapon</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>weapon</span> <span class=p>=</span> <span class=n>weapon</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>CharacterDirector</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>CreateWarrior</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Character</span> <span class=n>result</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Character</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetName</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetWeapon</span><span class=p>(</span><span class=s>&#34;Sword&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=n>CreateMgician</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Character</span> <span class=n>result</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Character</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetName</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>SetWeapon</span><span class=p>(</span><span class=s>&#34;Wand&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 实际上上述代码更接近于简单工厂，Director和流式方法的应用并不代表着使用了建造者方法</p><p>​ 建造者模式分离了构建和表示，也就是分离了<strong>构建的步骤</strong>和<strong>实际的对象内容</strong>
​ 意思是，我们定义了构建的步骤，但最终获得的内容不是改变步骤本身的定义实现的，而是通过<strong>具体建造者实现类 对构建步骤的具体实现</strong> 和 <strong>客户端/Director 对这些步骤的选择性调用与参数传递</strong></p><h2 id=桥接模式>桥接模式</h2><p>​ 桥接模式是为了优化功能组合的实现，对于有<strong>两个</strong>变化维度的系统，通过将抽象和行为分离，用组合代替继承，降低耦合，易于修改</p><p>​ 例如，我有一个咖啡，他有中杯和大杯，有加奶和不加，我们可以做四种类，但如此做的话在将来想要加入新的超大杯，会很复杂；也可以分离这两个维度，这里选择将咖啡的大小作为抽象，加奶和不加奶是实现</p><h3 id=实现方法-2>实现方法</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Coffee</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>CoffeeImp</span> <span class=n>CoffeeImp</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>private</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>SetCoffeeImp</span><span class=p>(</span><span class=n>CoffeeImp</span> <span class=n>coffeeImp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_coffeeImp</span> <span class=p>=</span> <span class=n>coffeeImp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=k>void</span> <span class=n>PourCoffee</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MediumCoffee</span> <span class=p>:</span> <span class=n>Coffee</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>PourCoffee</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=m>2</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CoffeeImp</span><span class=p>.</span><span class=n>Pour</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=p>.</span><span class=n>Print</span><span class=p>(</span><span class=s>&#34;中杯&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SuperSizeCoffee</span> <span class=p>:</span> <span class=n>Coffee</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>PourCoffee</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=m>3</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CoffeeImp</span><span class=p>.</span><span class=n>Pour</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=p>.</span><span class=n>Print</span><span class=p>(</span><span class=s>&#34;大杯&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Imp -&gt; implement</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CoffeeImp</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=k>void</span> <span class=n>Pour</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>NoMilkCoffeeImp</span> <span class=p>:</span> <span class=n>CoffeeImp</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Pour</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=p>.</span><span class=n>Print</span><span class=p>(</span><span class=s>&#34;无奶的咖啡&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MilkCoffeeImp</span> <span class=p>:</span> <span class=n>CoffeeImp</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>Pour</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=p>.</span><span class=n>Print</span><span class=p>(</span><span class=s>&#34;加奶的咖啡&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在这个示例中，咖啡实际的行为实现是在CoffeeImp中实现的，咖啡抽象的实现调用了行为的实现</p><h2 id=装饰器模式>装饰器模式</h2><h2 id=状态模式>状态模式</h2><p>​ 状态模式适用于存在可枚举的状态、且每个状态有其特定的通用行为</p><p>​ 一般存在如下类：环境类（拥有状态的类）、抽象状态类、具体状态类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp></code></pre></td></tr></table></div></div><h2 id=观察者模式>观察者模式</h2></section><footer class=article-footer><section class=article-tags><a href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 FallingHeaven</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>